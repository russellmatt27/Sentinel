id: 53016cac-ca6c-4b2b-a4c4-7325afcb9502
name: Detect File Uploads and Downloads
description: |
  'Monitor file uploads and downloads to detect potential exfiltration or data theft activities.'
severity: Medium
status: Available
requiredDataConnectors:
  - connectorId: SensorSSHCowrie
    dataTypes:
      - newCowrie_CL
queryFrequency: 5m
queryPeriod: 5m
triggerOperator: gt
triggerThreshold: 0
tactics:
  - LateralMovement
relevantTechniques:
  - T0843
query: |
  newCowrie_CL
  | extend EventID = tostring(parse_json(RawData).eventid) 
  | extend URL = tostring(parse_json(RawData).url)
  | extend SourceIP = tostring(parse_json(RawData).src_ip)
  | extend Sha256Value = tostring(parse_json(RawData).shasum)
  | extend Message = tostring(parse_json(RawData).message)
  | extend Outfile = tostring(parse_json(RawData).outfile)
  | where EventID in ("cowrie.session.file_upload", "cowrie.session.file_download")
  | project EventID, SourceIP, URL, Outfile, Sha256Value
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
  - entityType: File
    fieldMappings:
      - identifier: Name
        columnName: Outfile
  - entityType: FileHash
    fieldMappings:
      - identifier: Value
        columnName: Sha256Value
      - identifier: Algorithm
        columnName: Message
  - entityType: URL
    fieldMappings:
      - identifier: Url
        columnName: URL
version: 1.0.1
kind: Scheduled