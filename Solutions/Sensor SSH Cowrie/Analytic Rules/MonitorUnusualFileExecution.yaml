id: f72805a7-b8c5-45fb-aacf-d0db7e0bf49b
name: Monitor Unusual File Execution
description: |
  'Detect attempts to execute files or scripts that are unusual or not typical for the environment.'
severity: Medium
status: Available
requiredDataConnectors:
  - connectorId: SensorSSHCowrie
    dataTypes:
      - newCowrie_CL
queryFrequency: 5m
queryPeriod: 5m
triggerOperator: gt
triggerThreshold: 0
tactics:
  - Execution
relevantTechniques:
  - T1204
query: |
  newCowrie_CL
  | extend EventID = tostring(parse_json(RawData).eventid)
  | extend Command = tostring(parse_json(RawData).command)
  | extend SourceIP = tostring(parse_json(RawData).src_ip)
  | where EventID == "cowrie.session.command"
  | where Command contains "wget" or Command contains "curl" or Command contains "chmod +x"
  | project SourceIP, Command
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
version: 1.0.1
kind: Scheduled